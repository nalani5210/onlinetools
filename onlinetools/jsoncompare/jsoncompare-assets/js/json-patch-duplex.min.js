var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},OriginalError=Error,jsonpatch;!function(p){function i(e,t){switch(typeof e){case"undefined":case"boolean":case"string":case"number":return e===t;case"object":if(null===e)return null===t;if(A(e)){if(!A(t)||e.length!==t.length)return!1;for(var r=0,n=e.length;n>r;r++)if(!i(e[r],t[r]))return!1;return!0}var o=g(t),a=o.length;if(g(e).length!==a)return!1;for(var r=0;a>r;r++)if(!i(e[r],t[r]))return!1;return!0;default:return!1}}function l(e){return-1===e.indexOf("/")&&-1===e.indexOf("~")?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function h(e){for(var t=0,r=w.length;r>t;t++)if(w[t].obj===e)return w[t]}function c(e,t){for(var r=0,n=e.observers.length;n>r;r++)if(e.observers[r].callback===t)return e.observers[r].observer}function n(e,t){for(var r=0,n=e.observers.length;n>r;r++)if(e.observers[r].observer===t)return void e.observers.splice(r,1)}function e(e,t){v(t),clearTimeout(t.next);var r=h(e);n(r,t)}function f(e){return"object"==typeof e?JSON.parse(JSON.stringify(e)):e}function t(e,t){var r,n=[],o=h(e);if(o?r=c(o,t):(o=new E(e),w.push(o)),r)return r;if(r={},o.value=f(e),t){r.callback=t,r.next=null;var a=this.intervals||[100,1e3,1e4,6e4];if(void 0===a.push)throw new OriginalError("jsonpatch.intervals must be an array");var i=0,s=function(){v(r)},p=function(){clearTimeout(r.next),r.next=setTimeout(function(){s(),i=0,r.next=setTimeout(u,a[i++])},0)},u=function(){s(),i==a.length&&(i=a.length-1),r.next=setTimeout(u,a[i++])};"undefined"!=typeof window&&(window.addEventListener?(window.addEventListener("mousedown",p),window.addEventListener("mouseup",p),window.addEventListener("keydown",p)):(document.documentElement.attachEvent("onmousedown",p),document.documentElement.attachEvent("onmouseup",p),document.documentElement.attachEvent("onkeydown",p))),r.next=setTimeout(u,a[i++])}return r.patches=n,r.object=e,o.observers.push(new _(t,r)),r}function v(e){for(var t,r=0,n=w.length;n>r;r++)if(w[r].obj===e.object){t=w[r];break}d(t.value,e.object,e.patches,""),e.patches.length&&a(t.value,e.patches);var o=e.patches;return o.length>0&&(e.patches=[],e.callback&&e.callback(o)),o}function d(e,t,r,n){for(var o=g(t),a=g(e),i=!1,s=!1,p=a.length-1;p>=0;p--){var u=a[p],h=e[u];if(t.hasOwnProperty(u)){var c=t[u];"object"==typeof h&&null!=h&&"object"==typeof c&&null!=c?d(h,c,r,n+"/"+l(u)):h!=c&&(i=!0,r.push({op:"replace",path:n+"/"+l(u),value:f(c)}))}else r.push({op:"remove",path:n+"/"+l(u)}),s=!0}if(s||o.length!=a.length)for(var p=0;p<o.length;p++){var u=o[p];e.hasOwnProperty(u)||r.push({op:"add",path:n+"/"+l(u),value:f(t[u])})}}function O(e){for(var t,r=0,n=e.length;n>r;){t=e.charCodeAt(r);{if(!(t>=48&&57>=t))return!1;r++}}return!0}function a(e,t,r){for(var n,o,a=!1,i=0,s=t.length;s>i;){n=t[i],i++;for(var p=n.path||"",u=p.split("/"),h=e,c=1,l=u.length,f=void 0;;){if(o=u[c],r&&void 0===f&&(void 0===h[o]?f=u.slice(0,c).join("/"):c==l-1&&(f=n.path),void 0!==f&&this.validator(n,i-1,e,f)),c++,void 0===o&&c>=l){a=b[n.op].call(n,h,o,e);break}if(A(h)){if("-"===o)o=h.length;else{if(r&&!O(o))throw new N("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",i-1,n.path,n);o=parseInt(o,10)}if(c>=l){if(r&&"add"===n.op&&o>h.length)throw new N("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",i-1,n.path,n);a=y[n.op].call(n,h,o,e);break}}else if(o&&-1!=o.indexOf("~")&&(o=o.replace(/~1/g,"/").replace(/~0/g,"~")),c>=l){a=m[n.op].call(n,h,o,e);break}h=h[o]}}return a}function r(e,t){var r=[];return d(e,t,r,""),r}function u(e){if(void 0===e)return!0;if("array"==typeof e||"object"==typeof e)for(var t in e)if(u(e[t]))return!0;return!1}function o(e,t,r,n){if("object"!=typeof e||null===e||A(e))throw new N("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,r);if(!m[e.op])throw new N("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,r);if("string"!=typeof e.path)throw new N("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,r);if(("move"===e.op||"copy"===e.op)&&"string"!=typeof e.from)throw new N("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,r);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&void 0===e.value)throw new N("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,r);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&u(e.value))throw new N("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,r);if(r)if("add"==e.op){var o=e.path.split("/").length,a=n.split("/").length;if(o!==a+1&&o!==a)throw new N("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,r)}else if("replace"===e.op||"remove"===e.op||"_get"===e.op){if(e.path!==n)throw new N("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,r)}else if("move"===e.op||"copy"===e.op){var i={op:"_get",path:e.from,value:void 0},s=p.validate([i],r);if(s&&"OPERATION_PATH_UNRESOLVABLE"===s.name)throw new N("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,r)}}function s(e,t){try{if(!A(e))throw new N("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)t=JSON.parse(JSON.stringify(t)),a.call(this,t,e,!0);else for(var r=0;r<e.length;r++)this.validator(e[r],r)}catch(e){if(e instanceof N)return e;throw e}}if(!p.observe){var g=function(e){if(A(e)){for(var t=new Array(e.length),r=0;r<t.length;r++)t[r]=r.toString();return t}if(Object.keys)return Object.keys(e);var t=[];for(var r in e)e.hasOwnProperty(r)&&t.push(r);return t},m={add:function(e,t){return e[t]=this.value,!0},remove:function(e,t){return delete e[t],!0},replace:function(e,t){return e[t]=this.value,!0},move:function(e,t,r){var n={op:"_get",path:this.from};return a(r,[n]),a(r,[{op:"remove",path:this.from}]),a(r,[{op:"add",path:this.path,value:n.value}]),!0},copy:function(e,t,r){var n={op:"_get",path:this.from};return a(r,[n]),a(r,[{op:"add",path:this.path,value:n.value}]),!0},test:function(e,t){return i(e[t],this.value)},_get:function(e,t){this.value=e[t]}},y={add:function(e,t){return e.splice(t,0,this.value),!0},remove:function(e,t){return e.splice(t,1),!0},replace:function(e,t){return e[t]=this.value,!0},move:m.move,copy:m.copy,test:m.test,_get:m._get},b={add:function(e){b.remove.call(this,e);for(var t in this.value)this.value.hasOwnProperty(t)&&(e[t]=this.value[t]);return!0},remove:function(e){for(var t in e)e.hasOwnProperty(t)&&m.remove.call(this,e,t);return!0},replace:function(e){return a(e,[{op:"remove",path:this.path}]),a(e,[{op:"add",path:this.path,value:this.value}]),!0},move:m.move,copy:m.copy,test:function(e){return JSON.stringify(e)===JSON.stringify(this.value)},_get:function(e){this.value=e}},w=[],E=function(){function e(e){this.observers=[],this.obj=e}return e}(),_=function(){function e(e,t){this.callback=e,this.observer=t}return e}();p.unobserve=e,p.observe=t,p.generate=v;var A;A=Array.isArray?Array.isArray:function(e){return e.push&&"number"==typeof e.length},p.apply=a,p.compare=r;var N=function(a){function e(e,t,r,n,o){a.call(this,e),this.message=e,this.name=t,this.index=r,this.operation=n,this.tree=o}return __extends(e,a),e}(OriginalError);p.JsonPatchError=N,p.Error=N,p.hasUndefined=u,p.validator=o,p.validate=s}}(jsonpatch||(jsonpatch={})),"undefined"!=typeof exports&&(exports.apply=jsonpatch.apply,exports.observe=jsonpatch.observe,exports.unobserve=jsonpatch.unobserve,exports.generate=jsonpatch.generate,exports.compare=jsonpatch.compare,exports.validate=jsonpatch.validate,exports.validator=jsonpatch.validator,exports.JsonPatchError=jsonpatch.JsonPatchError,exports.Error=jsonpatch.Error);